<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéµ YouTube Channel MP3 Downloader</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
    }

    header {
      background: #1f1f1f;
      padding: 1rem;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      color: #00ffcc;
    }

    form {
      margin: 1.5rem auto;
      max-width: 500px;
      display: flex;
      gap: 0.5rem;
      padding: 0 1rem;
    }

    input[type="text"] {
      flex: 1;
      padding: 0.6rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
    }

    button {
      padding: 0.6rem 1rem;
      background: #00cc88;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }

    #error {
      color: #ff4d4d;
      text-align: center;
      margin-top: 1rem;
    }

    #videos {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }

    .card {
      background: #1f1f1f;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      text-align: center;
      padding: 1rem;
    }

    .card img {
      width: 100%;
      border-radius: 6px;
    }

    .card .title {
      font-weight: bold;
      margin: 0.8rem 0;
      font-size: 0.95rem;
    }

    .btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      background: #00cc88;
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9rem;
      margin: 0.3rem;
      cursor: pointer;
    }

    .btn-video {
      background: #ff8800;
    }

    footer {
      text-align: center;
      padding: 1rem;
      background: #1f1f1f;
      font-size: 0.85rem;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

<header>
  <h1>üéµ YouTube Channel MP3 Downloader</h1>
  <p>Contoh: @saipulanuar atau URL channel</p>
</header>

<form id="form">
  <input type="text" id="channelId" placeholder="Masukkan Channel ID, URL, atau @username..." />
  <button type="submit">Cari</button>
</form>

<div id="error"></div>
<div id="videos"></div>

<footer>
  ¬© 2025 by Saipul Anuar ‚Ä¢ Powered by YouTube RSS & API
</footer>

<script>
const form = document.getElementById('form');
const container = document.getElementById('videos');
const errorBox = document.getElementById('error');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  let input = document.getElementById('channelId').value.trim();
  if (!input) return;

  errorBox.textContent = '';
  container.innerHTML = '<p>üîÑ Memuat video...</p>';

  // Deteksi input apakah video URL
  const videoMatch = input.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
  if (videoMatch) {
    const videoId = videoMatch[1];
    await renderSingleVideo(videoId);
    return;
  }

  // Tangani input channel
  let channelId = null;

  if (input.startsWith('@')) {
    input = 'https://www.youtube.com/' + input;
  }

  if (input.startsWith('http')) {
    try {
      const url = new URL(input);
      const parts = url.pathname.split('/');
      if (parts[1] === 'channel' && parts[2]) {
        channelId = parts[2];
      } else if (parts[1].startsWith('@')) {
        const res = await fetch(`https://www.youtube.com/${parts[1]}`);
        const text = await res.text();
        const match = text.match(/channel_id=([\w\-]+)/);
        if (match && match[1]) {
          channelId = match[1];
        } else {
          throw new Error('Gagal menemukan channel_id dari username.');
        }
      } else {
        throw new Error('Format URL tidak dikenali.');
      }
    } catch (err) {
      errorBox.textContent = '‚ùå URL tidak valid atau username tidak ditemukan.';
      container.innerHTML = '';
      return;
    }
  } else {
    channelId = input;
  }

  if (!channelId) {
    errorBox.textContent = '‚ùå Gagal mengekstrak channel_id.';
    container.innerHTML = '';
    return;
  }

  const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${channelId}`;
  const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;

  try {
    const res = await fetch(apiUrl);
    const data = await res.json();

    if (!data.items || data.items.length === 0) {
      throw new Error('Tidak ada video ditemukan.');
    }

    container.innerHTML = '';
    let counter = 0;
    for (let item of data.items) {
      if (item.link.includes('/shorts/')) continue;
      if (counter >= 20) break;

      const videoId = item.link.split('=')[1];
      const title = item.title;
      const thumbnail = `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;

      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${thumbnail}" alt="Thumbnail">
        <div class="title">${title}</div>
        <button class="btn" onclick="download('${videoId}', 'mp3')">Download MP3</button>
        <button class="btn btn-video" onclick="download('${videoId}', 'mp4')">Download Video</button>
      `;
      container.appendChild(card);
      counter++;
    }
  } catch (err) {
    console.error(err);
    errorBox.textContent = '‚ùå Gagal mengambil video dari channel.';
    container.innerHTML = '';
  }
});

async function renderSingleVideo(videoId) {
  try {
    const apiUrl = `https://api.saipulanuar.eu.org/api/download/ytdl?url=https://www.youtube.com/watch?v=${videoId}`;
    const res = await fetch(apiUrl);
    const data = await res.json();

    if (!data.status) {
      throw new Error('Gagal memuat video');
    }

    const title = data.result.title;
    const thumbnail = data.result.thumbnail;

    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${thumbnail}" alt="Thumbnail">
      <div class="title">${title}</div>
      <button class="btn" onclick="window.open('${data.result.mp3}', '_blank')">Download MP3</button>
      <button class="btn btn-video" onclick="window.open('${data.result.mp4}', '_blank')">Download Video</button>
    `;
    container.innerHTML = '';
    container.appendChild(card);
  } catch (err) {
    console.error(err);
    errorBox.textContent = '‚ùå Gagal menampilkan video.';
    container.innerHTML = '';
  }
}

async function download(videoId, type) {
  const apiUrl = `https://api.saipulanuar.eu.org/api/download/ytdl?url=https://www.youtube.com/watch?v=${videoId}`;
  try {
    const res = await fetch(apiUrl);
    const json = await res.json();
    if (!json.status) {
      alert('‚ùå Gagal mengambil link download.');
      return;
    }
    const link = type === 'mp3' ? json.result.mp3 : json.result.mp4;
    window.open(link, '_blank');
  } catch (err) {
    alert('‚ùå Terjadi kesalahan saat menghubungi API.');
  }
}
</script>


</body>
</html>
