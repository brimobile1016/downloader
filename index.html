<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>üéµ YouTube Channel MP3 Downloader</title>
    <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
    }

    header {
      background: #1f1f1f;
      padding: 1rem;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      color: #00ffcc;
    }

    form {
      margin: 1.5rem auto;
      max-width: 500px;
      display: flex;
      gap: 0.5rem;
      padding: 0 1rem;
    }

    input[type="text"] {
      flex: 1;
      padding: 0.6rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
    }

    button {
      padding: 0.6rem 1rem;
      background: #00cc88;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }

    #error {
      color: #ff4d4d;
      text-align: center;
      margin-top: 1rem;
    }

    #videos {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }

    .card {
      background: #1f1f1f;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      text-align: center;
      padding: 1rem;
    }

    .card img {
      width: 100%;
      border-radius: 6px;
    }

    .card .title {
      font-weight: bold;
      margin: 0.8rem 0;
      font-size: 0.95rem;
    }

    .btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      background: #00cc88;
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9rem;
      margin: 0.3rem;
      cursor: pointer;
    }

    .btn-video {
      background: #ff8800;
    }

    footer {
      text-align: center;
      padding: 1rem;
      background: #1f1f1f;
      font-size: 0.85rem;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h2>üéµ YouTube Channel MP3 Downloader</h2>
  <form id="form">
    <input type="text" id="input" placeholder="Channel ID, @username, atau URL video" required style="width:60%">
    <button type="submit">Cari</button>
  </form>
  <div id="results"></div>
  <footer>
    <p>¬© 2025 by Saipul Anuar ‚Ä¢ Powered by YouTube RSS & API</p>
  </footer>

  <script>
    document.getElementById('form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const input = document.getElementById('input').value.trim();
      const results = document.getElementById('results');
      results.innerHTML = 'üîÑ Memuat...';

      let isVideo = false;
      let videoId = '';
      let channelId = '';

      if (input.includes('watch?v=')) {
        // Tautan video
        const match = input.match(/v=([^&]+)/);
        if (match) {
          videoId = match[1];
          isVideo = true;
        }
      } else if (input.startsWith('@')) {
        // Username
        const username = input.slice(1);
        channelId = `https://www.youtube.com/@${username}`;
      } else if (input.includes('channel/')) {
        const match = input.match(/channel\/([a-zA-Z0-9_-]+)/);
        if (match) channelId = match[1];
      } else {
        // Anggap sebagai ID channel langsung
        channelId = input;
      }

      if (isVideo && videoId) {
        // Fetch detail satu video
        try {
          const res = await fetch(`https://api.saipulanuar.eu.org/api/download/ytdl?url=https://www.youtube.com/watch?v=${videoId}`);
          const data = await res.json();
          if (!data.status) throw new Error('‚ùå Gagal memuat video!');
          const vid = data.result;
          results.innerHTML = `
            <div class="video-card">
              <img src="${vid.thumbnail}" alt="${vid.title}">
              <h4>${vid.title}</h4>
              <p><b>${vid.author}</b></p>
              <a class="btn" href="${vid.mp3}" target="_blank">Download MP3</a>
              <a class="btn btn-video" href="${vid.mp4}" target="_blank">Download Video</a>
            </div>
          `;
        } catch (err) {
          results.innerHTML = '‚ùå Gagal mengambil data video.';
        }
        return;
      }

      // Fetch video list dari channel
      try {
        const rssUrl = channelId.startsWith('http') ? `${channelId}/videos` : `https://www.youtube.com/channel/${channelId}/videos`;
        const feedUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`;
        const rssRes = await fetch(feedUrl);
        const rssData = await rssRes.json();
        const html = rssData.contents;

        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const anchors = Array.from(doc.querySelectorAll('a#video-title'));
        const uniqueVideos = new Set();
        const videoIds = [];

        for (let a of anchors) {
          const href = a.getAttribute('href');
          if (href && href.startsWith('/watch?v=') && !href.includes('shorts')) {
            const id = href.split('v=')[1].split('&')[0];
            if (!uniqueVideos.has(id)) {
              uniqueVideos.add(id);
              videoIds.push(id);
              if (videoIds.length >= 20) break;
            }
          }
        }

        const cards = await Promise.all(videoIds.map(async id => {
          try {
            const res = await fetch(`https://api.saipulanuar.eu.org/api/download/ytdl?url=https://www.youtube.com/watch?v=${id}`);
            const data = await res.json();
            if (!data.status) return '';
            const v = data.result;
            return `
              <div class="video-card">
                <img src="${v.thumbnail}" alt="${v.title}">
                <h4>${v.title}</h4>
                <p><b>${v.author}</b></p>
                <a class="btn" href="${v.mp3}" target="_blank">Download MP3</a>
                <a class="btn btn-video" href="${v.mp4}" target="_blank">Download Video</a>
              </div>
            `;
          } catch {
            return '';
          }
        }));

        results.innerHTML = cards.join('') || '‚ùå Tidak ada video ditemukan.';
      } catch (err) {
        results.innerHTML = '‚ùå Gagal mengambil RSS feed. Pastikan URL benar atau coba lagi nanti.';
      }
    });
  </script>
</body>
</html>
